---
title: 完整开发指南
description: ezBookkeeping 项目的完整开发、运行、打包部署说明
---

# ezBookkeeping 完整开发指南

本文档提供 ezBookkeeping 项目从开发到部署的完整流程说明，包括环境搭建、依赖安装、本地调试、编译构建、打包部署等所有步骤。

## 目录

- [环境要求](#环境要求)
- [项目结构](#项目结构)
- [初始化与依赖安装](#初始化与依赖安装)
- [本地开发与调试](#本地开发与调试)
- [编译构建](#编译构建)
- [打包与部署](#打包与部署)
- [常见问题](#常见问题)

---

## 环境要求

### 系统要求

- **操作系统**：Windows、macOS 或 Linux
- **RAM**：至少 2GB（推荐 4GB+）
- **磁盘空间**：至少 1GB

### 必需工具

| 工具 | 版本要求 | 用途 | 下载链接 |
|------|---------|------|---------|
| **Git** | 2.0+ | 版本控制 | https://git-scm.com/ |
| **Go** | 1.25+ | 后端编译 | https://golang.org/ |
| **GCC** | 任意版本 | C 编译支持 | https://gcc.gnu.org/ |
| **Node.js** | 24.x | 前端依赖管理 | https://nodejs.org/ |
| **npm** | 10.0+ | JavaScript 包管理（通常随 Node.js 附带） | - |

**发布版本**：官方使用 Golang 1.25 和 Node.js 24.x 进行编译。

### Windows 特殊说明

如果在 Windows 上需要使用 `build.ps1` 脚本，还需要：
- **7z**（用于打包）：https://www.7-zip.org/
- **PowerShell 5.1+**：通常已预装

### 验证安装

```bash
git --version          # 应显示 Git 版本
go version            # 应显示 Go 版本
gcc --version         # 应显示 GCC 版本（Windows 用户可能需要单独安装）
node --version        # 应显示 Node.js 版本
npm --version         # 应显示 npm 版本
```

---

## 项目结构

```
ezbookkeeping/
├── cmd/                      # Go 命令行实现
│   ├── base.go              # 基础命令
│   ├── webserver.go         # Web 服务器启动
│   ├── database.go          # 数据库初始化和管理
│   ├── user_data.go         # 用户数据导入导出
│   └── ...
├── pkg/                      # Go 业务逻辑包
│   ├── api/                 # API 路由处理
│   ├── services/            # 业务服务层
│   ├── models/              # 数据模型
│   ├── datastore/           # 数据访问层
│   ├── auth/                # 认证模块
│   ├── mail/                # 邮件服务
│   ├── llm/                 # 大语言模型集成
│   ├── mcp/                 # MCP 协议实现
│   └── ...
├── src/                      # TypeScript/Vue 前端源码
│   ├── index-main.ts        # 主入口（自动跳转到桌面/移动版）
│   ├── desktop-main.ts      # 桌面版入口
│   ├── mobile-main.ts       # 移动版入口
│   ├── index.html           # 主页面
│   ├── desktop.html         # 桌面版页面
│   ├── mobile.html          # 移动版页面
│   ├── components/          # Vue 组件
│   ├── views/               # 页面视图
│   ├── stores/              # Pinia 状态管理
│   ├── router/              # Vue Router 路由配置
│   ├── locales/             # 国际化文件
│   ├── styles/              # 全局样式
│   ├── lib/                 # 工具库
│   ├── core/                # 核心模块
│   └── ...
├── public/                   # 静态资源（robots.txt 等）
├── conf/                     # 配置文件
│   └── ezbookkeeping.ini    # 默认配置文件
├── templates/                # 后端模板
│   ├── email/               # 邮件模板
│   └── prompt/              # AI 提示词模板
├── docker/                   # Docker 配置
├── docs/                     # 文档
├── ezbookkeeping.go          # Go 主程序入口
├── package.json              # Node.js 依赖配置
├── go.mod                    # Go 模块定义
├── vite.config.ts           # Vite 前端构建配置
├── tsconfig.json            # TypeScript 配置
├── jest.config.ts           # Jest 测试配置
├── eslint.config.mjs        # ESLint 配置
├── build.sh                 # Linux/macOS 构建脚本
├── build.bat                # Windows cmd 构建脚本
├── build.ps1                # Windows PowerShell 构建脚本
├── Dockerfile               # Docker 镜像定义
└── docker-bake.hcl         # Docker Build Kit 配置
```

---

## 初始化与依赖安装

### 1. 克隆源代码

```bash
git clone https://github.com/mayswind/ezbookkeeping.git
cd ezbookkeeping
```

### 2. 后端依赖安装

#### 方式一：自动安装（推荐）

```bash
go get .
```

这会根据 `go.mod` 和 `go.sum` 自动下载所有依赖包。

#### 方式二：手动依赖管理

```bash
# 更新依赖
go get -u ./...

# 下载所有依赖（不更新）
go mod download

# 检查和清理未使用的依赖
go mod tidy

# 验证依赖完整性
go mod verify
```

### 3. 前端依赖安装

#### 使用 npm

```bash
npm install
```

#### 使用 yarn（可选）

```bash
npm install -g yarn
yarn install
```

#### 使用 pnpm（可选，更快更节省空间）

```bash
npm install -g pnpm
pnpm install
```

### 4. 验证安装

```bash
# 验证后端依赖
go list -m all

# 验证前端依赖
npm list
```

---

## 本地开发与调试

### 后端开发

#### 启动后端服务器

```bash
# 方式一：直接运行（使用默认配置）
go run ezbookkeeping.go server run

# 方式二：指定配置文件
go run ezbookkeeping.go --conf-path=conf/ezbookkeeping.ini server run

# 方式三：指定监听地址和端口
go run ezbookkeeping.go server run --addr=127.0.0.1 --port=8080
```

**默认行为**：
- 监听地址：`127.0.0.1:8080`
- 配置文件：`conf/ezbookkeeping.ini`
- 日志输出到控制台

#### 查看后端命令帮助

```bash
go run ezbookkeeping.go --help                    # 显示全局帮助
go run ezbookkeeping.go server --help             # 显示 server 子命令帮助
go run ezbookkeeping.go server run --help         # 显示 server run 子命令帮助
```

#### 后端调试技巧

- **打印日志**：代码中使用 `log` 或 `logrus` 包输出日志
- **API 测试**：使用 Postman、curl 或 VSCode 的 REST Client 扩展
- **数据库查询**：
  ```bash
  # SQLite 数据库查看
  sqlite3 ezbookkeeping.db

  # 导出数据备份
  go run ezbookkeeping.go data export --output=backup.csv
  ```

### 前端开发

#### 启动开发服务器

```bash
npm run serve
```

**配置说明**：
- 前端开发服务器监听：`http://127.0.0.1:8081`
- 自动代理后端请求到 `http://127.0.0.1:8080`
- 支持热模块更新（HMR）
- 源代码修改自动刷新

#### 访问应用

在浏览器中打开：[http://127.0.0.1:8081](http://127.0.0.1:8081)

应用会自动检测设备类型：
- **桌面设备**：跳转到桌面版（`/desktop-main.ts`）
- **移动设备**：跳转到移动版（`/mobile-main.ts`）

#### 前端开发工具

```bash
# 代码 linting 和修复
npm run lint

# 编译前端文件（生产环境）
npm run build

# 预览构建后的文件
npm run serve:dist

# 运行单元测试
npm run test

# 开发时可用的其他任务
npm run --list    # 查看所有可用任务
```

### 完整开发工作流

**建议同时在两个终端窗口运行**：

**终端 1 - 后端开发**：
```bash
cd ezbookkeeping
go run ezbookkeeping.go server run
```

**终端 2 - 前端开发**：
```bash
cd ezbookkeeping
npm run serve
```

然后在浏览器访问 `http://127.0.0.1:8081`

### 项目配置

编辑 [conf/ezbookkeeping.ini](../conf/ezbookkeeping.ini) 进行配置：

```ini
# 服务器配置
[server]
listen_address = 127.0.0.1
listen_port = 8080
http_proxy =

# 数据库配置（SQLite）
[database]
type = sqlite3
sqlite_path = ezbookkeeping.db

# 日志配置
[log]
level = info
output = file
output_file = logs/ezbookkeeping.log
```

---

## 编译构建

### 前端构建

#### Linux / macOS

```bash
./build.sh frontend
```

#### Windows（cmd）

```cmd
build.bat frontend
```

#### Windows（PowerShell）

```powershell
.\build.ps1 frontend
```

**输出**：前端文件构建到 `dist/` 目录

**构建产物说明**：
- `dist/desktop/` - 桌面版静态文件
- `dist/mobile/` - 移动版静态文件
- `dist/index.html` - 主入口 HTML

### 后端构建

#### Linux / macOS

```bash
./build.sh backend
```

#### Windows（cmd）

```cmd
build.bat backend
```

#### Windows（PowerShell）

```powershell
.\build.ps1 backend
```

**输出**：后端二进制文件 `ezbookkeeping`（或 `ezbookkeeping.exe` 在 Windows）

#### 手动构建后端

如果不想使用构建脚本，可以手动编译：

```bash
# 基础编译
go build -o ezbookkeeping ezbookkeeping.go

# 编译并设置版本信息
VERSION=$(cat package.json | grep version | head -1 | awk -F': "' '{print $2}' | awk -F'"' '{print $1}')
COMMIT=$(git rev-parse --short=7 HEAD)
BUILD_TIME=$(date +%s)
BUILD_DATE=$(date +%Y%m%d)

go build \
  -ldflags "-X main.Version=$VERSION -X main.CommitHash=$COMMIT -X main.BuildUnixTime=$BUILD_TIME" \
  -o ezbookkeeping \
  ezbookkeeping.go
```

### 跳过 Lint 和测试

构建脚本默认执行 lint 和单元测试。如需跳过：

```bash
# 跳过 lint（Linux/macOS）
./build.sh frontend --no-lint

# 跳过测试（Windows PowerShell）
.\build.ps1 frontend -NoTest

# 同时跳过 lint 和测试
./build.sh backend --no-lint --no-test
```

### 发布版本构建

发布版本会使用特殊标记：

```bash
# Linux/macOS
./build.sh frontend --release

# Windows PowerShell
.\build.ps1 frontend -Release
```

---

## 打包与部署

### 完整包打包

#### Linux / macOS

```bash
# 打包为 tar.gz
./build.sh package -o ezbookkeeping.tar.gz
```

#### Windows（cmd）

```cmd
# 打包为 zip
build.bat package -o ezbookkeeping.zip
```

#### Windows（PowerShell）

```powershell
# 打包为 zip
.\build.ps1 package -Output ezbookkeeping.zip
```

**打包内容**：
- 编译后的后端二进制文件
- 构建后的前端静态文件
- 配置文件示例
- 文档
- 许可证

### Docker 部署

#### 构建 Docker 镜像

**Linux（使用 Docker BuildKit）**：

```bash
./build.sh docker -t ezbookkeeping:release
```

**手动构建**：

```bash
docker build -t ezbookkeeping:release .
```

#### 运行 Docker 容器

```bash
# 基础启动
docker run -p 8080:8080 ezbookkeeping:release

# 指定容器名和后台运行
docker run -d \
  --name ezbookkeeping \
  -p 8080:8080 \
  ezbookkeeping:release

# 使用自定义配置和持久化存储
docker run -d \
  --name ezbookkeeping \
  -p 8080:8080 \
  -v /path/to/ezbookkeeping.ini:/app/conf/ezbookkeeping.ini \
  -v /path/to/db:/app/data \
  ezbookkeeping:release
```

#### Docker Compose 部署

创建 `docker-compose.yml`：

```yaml
version: '3.8'

services:
  ezbookkeeping:
    image: mayswind/ezbookkeeping:latest-snapshot
    container_name: ezbookkeeping
    ports:
      - "8080:8080"
    volumes:
      - ./ezbookkeeping.ini:/app/conf/ezbookkeeping.ini:ro
      - ./data:/app/data
    environment:
      - TZ=Asia/Shanghai
    restart: unless-stopped

  # 可选：MySQL 数据库
  # mysql:
  #   image: mysql:8.0
  #   container_name: ezbookkeeping-mysql
  #   environment:
  #     MYSQL_ROOT_PASSWORD: your_password
  #     MYSQL_DATABASE: ezbookkeeping
  #   volumes:
  #     - ./mysql_data:/var/lib/mysql
  #   restart: unless-stopped
```

启动服务：

```bash
docker-compose up -d

# 查看日志
docker-compose logs -f ezbookkeeping

# 停止服务
docker-compose down
```

### 二进制部署

#### Linux / macOS

```bash
# 1. 构建二进制
./build.sh package -o ezbookkeeping.tar.gz

# 2. 解压到部署目录
mkdir -p /opt/ezbookkeeping
tar -zxf ezbookkeeping.tar.gz -C /opt/ezbookkeeping

# 3. 进入目录
cd /opt/ezbookkeeping

# 4. 修改配置（可选）
vi conf/ezbookkeeping.ini

# 5. 启动应用
./ezbookkeeping server run

# 6. 验证应用（另一个终端）
curl http://127.0.0.1:8080/api/v1/users/profile
```

#### Windows

```cmd
# 1. 构建包
build.bat package -o ezbookkeeping.zip

# 2. 解压到部署目录
mkdir C:\ezbookkeeping
# 使用 Windows 资源管理器或 7z 解压 ezbookkeeping.zip

# 3. 进入目录
cd C:\ezbookkeeping

# 4. 修改配置（可选）
notepad conf\ezbookkeeping.ini

# 5. 启动应用
.\ezbookkeeping.exe server run

# 6. 验证应用（另一个 cmd 窗口）
curl http://127.0.0.1:8080/api/v1/users/profile
```

#### 创建 Systemd 服务（Linux）

查看示例：[etc/systemd/ezbookkeeping.service](../etc/systemd/ezbookkeeping.service)

```bash
# 1. 复制服务文件
sudo cp etc/systemd/ezbookkeeping.service /etc/systemd/system/

# 2. 修改服务文件中的路径（如需要）
sudo vi /etc/systemd/system/ezbookkeeping.service

# 3. 重新加载 systemd
sudo systemctl daemon-reload

# 4. 启动服务
sudo systemctl start ezbookkeeping

# 5. 查看状态
sudo systemctl status ezbookkeeping

# 6. 开机自启
sudo systemctl enable ezbookkeeping

# 7. 查看日志
sudo journalctl -u ezbookkeeping -f
```

### 数据库配置

在 [conf/ezbookkeeping.ini](../conf/ezbookkeeping.ini) 中配置数据库：

#### SQLite（默认，无需额外设置）

```ini
[database]
type = sqlite3
sqlite_path = ezbookkeeping.db
```

#### MySQL

```ini
[database]
type = mysql
mysql_host = localhost
mysql_port = 3306
mysql_user = ezbookkeeping
mysql_password = your_password
mysql_db = ezbookkeeping

# 连接池配置（可选）
mysql_max_open_conns = 100
mysql_max_idle_conns = 10
mysql_conn_max_lifetime = 3600
```

初始化数据库：

```bash
./ezbookkeeping database init --db-type=mysql
```

#### PostgreSQL

```ini
[database]
type = postgres
postgres_host = localhost
postgres_port = 5432
postgres_user = ezbookkeeping
postgres_password = your_password
postgres_db = ezbookkeeping
```

初始化数据库：

```bash
./ezbookkeeping database init --db-type=postgres
```

---

## 常见问题

### Q1: 后端启动提示找不到配置文件

**原因**：默认配置文件路径为 `conf/ezbookkeeping.ini`

**解决方案**：
```bash
# 方式一：从正确的目录运行
cd /path/to/ezbookkeeping
go run ezbookkeeping.go server run

# 方式二：指定配置文件路径
go run ezbookkeeping.go --conf-path=/path/to/ezbookkeeping.ini server run
```

### Q2: 前端访问后端 API 返回 404 或 CORS 错误

**原因**：开发环境的代理配置问题或后端未启动

**解决方案**：
1. 确保后端服务已启动：`go run ezbookkeeping.go server run`
2. 检查后端监听地址：默认 `127.0.0.1:8080`
3. 确保前端开发服务器已启动：`npm run serve`
4. 查看 [vite.config.ts](../vite.config.ts) 中的代理配置

### Q3: 前端 npm install 失败或速度很慢

**原因**：npm 源服务器连接问题或网络速度慢

**解决方案**：
```bash
# 方式一：更换为国内镜像源（阿里）
npm config set registry https://registry.npmmirror.com/

# 方式二：使用 pnpm（推荐，速度更快）
npm install -g pnpm
pnpm install

# 方式三：清除缓存重试
npm cache clean --force
npm install
```

### Q4: 后端编译失败，提示 GCC 相关错误

**原因**：GCC 未安装或未在 PATH 中

**解决方案**：

- **Windows**：安装 MinGW-w64（https://www.mingw-w64.org/）或 TDM-GCC
- **macOS**：
  ```bash
  xcode-select --install
  ```
- **Linux（Ubuntu/Debian）**：
  ```bash
  sudo apt-get install build-essential
  ```

### Q5: SQLite 数据库文件无法写入

**原因**：文件权限问题或磁盘空间不足

**解决方案**：
```bash
# 检查磁盘空间
df -h

# 检查当前目录权限
ls -la

# 修改权限（如需要）
chmod 755 .
```

### Q6: 如何重置管理员账户密码

```bash
./ezbookkeeping user password --user-id=1 --new-password=NewPassword123
```

### Q7: 如何从其他应用导入数据

```bash
# 支持多种格式导入
./ezbookkeeping data import --input=exported.csv --format=csv
```

### Q8: 构建发布版本时应该做什么

```bash
# 1. 更新版本号在 package.json
# 2. 执行发布版本构建
./build.sh package -o ezbookkeeping.tar.gz --release

# 3. 使用构建脚本会自动：
#    - 从 git 获取提交哈希
#    - 设置构建时间戳
#    - 执行 lint 检查
#    - 运行单元测试（如未跳过）
```

### Q9: 如何加速大型数据库的初始化

```bash
# 在 ezbookkeeping.ini 中配置
[database]
# 禁用外键检查可加速初始化（仅在初始化时）
# disable_foreign_key = true

# 之后重新启用
```

### Q10: 生产环境应该如何配置日志

```ini
[log]
# 日志级别：debug, info, warn, error
level = info

# 输出方式：file（文件）/ console（控制台）
output = file

# 日志文件路径
output_file = logs/ezbookkeeping.log

# 日志文件大小限制（字节）
max_file_size = 104857600  # 100MB

# 最多保留日志文件数
max_backups = 10

# 日志文件最多保留天数
max_age = 30
```

---

## 进阶主题

### 多语言开发

前端国际化文件位于 [src/locales/](../src/locales/)，支持多语言。

在组件中使用：
```vue
<template>
  <p>{{ $t('message.hello') }}</p>
</template>
```

### 性能优化

**前端优化**：
- 启用 gzip 压缩
- 代码分割和懒加载
- 使用 PWA 缓存

**后端优化**：
- 启用数据库连接池
- 配置缓存层
- 优化数据库查询

### 容器化部署

参考 [Dockerfile](../Dockerfile) 和 [docker-bake.hcl](../docker-bake.hcl) 了解详细配置。

### 更新与升级

```bash
# 1. 备份数据库
cp ezbookkeeping.db ezbookkeeping.db.backup

# 2. 获取最新源代码
git pull origin main

# 3. 重新编译
./build.sh package -o ezbookkeeping-new.tar.gz

# 4. 备份当前版本并替换
mv ezbookkeeping ezbookkeeping.old
tar -zxf ezbookkeeping-new.tar.gz

# 5. 重启应用
# 如果使用 systemd，使用：
# sudo systemctl restart ezbookkeeping
```

---

## 更多信息

- **官方仓库**：https://github.com/mayswind/ezbookkeeping
- **在线演示**：https://ezbookkeeping-demo.mayswind.net
- **Docker Hub**：https://hub.docker.com/r/mayswind/ezbookkeeping
- **许可证**：MIT
- **贡献指南**：请提交 Pull Request 到官方仓库

---

## 文档历史

| 版本 | 日期 | 说明 |
|-----|------|------|
| 1.0 | 2026-01-07 | 初版，包含完整开发到部署流程 |

